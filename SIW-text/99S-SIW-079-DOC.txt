Using Numerical Weather Modeling to Customize Synthetic Natural EnvironmentsTodd A. Hutchinson, Peter S. Dailey, Robert A. Reynolds, Dana Z. Sherer, James R. StaudingerLitton/TASC55 Walkers Brook DriveReading, MA 01867781-942-2000tahutchinson@tasc.com Keywords:Synthetic Natural Environments, User-controlled weather, Numerical Weather Prediction ABSTRACT: The Total Atmosphere Ocean Services (TAOS) system, developed at TASC, is used to distribute both atmospheric and oceanographic data into a common synthetic battlespace.  Until now, TAOS has largely relied on historical gridded environmental products such as those provided by the Defense Modeling and Simulation Office’s (DMSO) Master Environmental Library (MEL).  With the recent availability of numerical weather models able to run efficiently and dependably in a workstation environment, and the development of variational data assimilation techniques, the generation of high-resolution “custom” gridded weather fields has become feasible.The fifth generation of the Pennsylvania State University/National Center for Atmospheric Research Mesoscale Model (MM5) has been integrated with TAOS.  The MM5 has a long-standing record of success and acceptance throughout the University community and more recently within the United States Air Force.  While the MM5 has been widely accepted scientifically, a complex setup process often makes configuration of the model difficult and tedious.  To alleviate these problems, a graphical user interface (GUI) has been developed to configure and run the MM5.  The GUI allows experienced MM5 users to set any of the low-level MM5 parameters, while allowing novice users to accept appropriate system-selected defaults for nearly all parameters.  The MM5 can be used to create actual weather conditions for a given input region and time, or to drive towards specified weather conditions (i.e. a rain event, etc.) which are deemed necessary to meet desired training goals.  Various techniques, including parameter modification, relaxation (nudging), and variational data assimilation (3DVAR, 4DVAR), are used to drive the MM5 towards specified conditions.1. IntroductionSimulation systems play a key role in the ability of the military to prepare personnel for combat.  These systems also provide useful information about the performance of weapons, both stockpiled and under development.  A critical objective of the next generation of simulation systems is the ability to customize synthetic natural environments (atmosphere-ocean-space) to efficiently meet training objectives while maintaining high levels of realism and physical consistency.The Total Atmosphere Ocean Services (TAOS) system, developed at TASC, is a major application of the Defense Advanced Research Projects Agency’s (DARPA) initiative in advanced distributed simulation.  TAOS can be termed an environmental data server.  That is, TAOS software distributes both atmospheric and oceanographic data to virtual and constructive simulation from geographically distributed locations in a common synthetic battlespace.TAOS is designed to provide a consistent, detailed and dynamic description of the atmosphere-ocean-littoral environment using 4-D grids (3-D spatial and time) to provide a common representation of the natural environment.  Until now, TAOS has largely relied on gridded forecast products such as those provided by the Defense Modeling and Simulation Office (DMSO) Master Environmental Library (MEL).  With the recent availability of weather prediction models able to run efficiently and dependably in a workstation environment, the generation of “custom” gridded fields has become feasible.2. Building Customized SNEs  Once exposed to the use of high-fidelity SNEs in their simulations, most SNE users become very interested in specifying what the details of the SNE scenario should be.  The use of archived data sources can serve many needs, but it is limited by what is available to the exercise planner – he can only use weather that actually occurred sometime in the past and is limited to  the resolution of the archived datasets.  Programs such as MEL’s Weather Scenario Generator (WSG), sponsored by DMSO’s Modeling & Simulation Executive Agents (MSEAs) for Air & Space, are developing efficient search mechanisms for matching a specified set of environmental constraints to historical data, yet the fundamental limitations of available historical data remain.Recent advances in desktop computing hardware are opening up a new option for exercise planners – creation, on-demand, of environmental scenarios at their desktop.  Numerical weather prediction models that once required supercomputers can now be effectively run on mid-range workstations.  The ratio of wall clock time needed to generate a time history of gridded environmental data to the number of hours of data has now reached levels that make on-demand model runs practical.  The MM5 mesoscale numerical weather prediction model of NCAR (National Center for Atmospheric Research) is an example of such a model.Once the hurdle of computational feasibility is passed, the next step is automating the process of running the environmental models to support their use by non-experts.  These models are complex, and have elaborate input data preparation that is often specified in text files reminiscent of the mainframe and supercomputers they once ran on.  Examples of key considerations for configuring such models to run in an automated mode are: •	Choice of domain (land boundaries, surface terrain elevation, land-use categories) •	Choice of resolution•	Initialization of the model for maintained stability throughout the run	•	Consistent and appropriate control parameter settings (derivation of parameters from grid, time step, and resolution settings, e.g., choice of map projection).Significant knowledge of environmental science and the numerical models must be embedded in such a system.  However, the fact that such models are run several times daily in “production mode” in support of operational users (e.g., at FNMOC, AFWA) indicates that the processes for running and validating such models have already been extensively studied and automated. The next key step in building user-specified SNEs on the desktop is to be able to drive the model outputs to meet a set of specified constraints.  For example, “low clouds on day one followed by heavy rain on day three”.  One of the more effective and sophisticated modern techniques for meeting such requirements is the use of four-dimensional variational data assimilation (4DVAR).  4DVAR utilizes the adjoint to a numerical model defined by a set of differential equations.  The adjoint can be thought of as a  numerical model running “in reverse”.  It allows the set of initial conditions which will produce a specified end condition be (approximately) determined.  Through the combination of this method and others, the numerical model can be driven to meet a set of desired constraint conditions, while preserving the basic internal physical consistency of the atmosphere [1].TASC has undertaken an internal R&D project that is demonstrating these approaches to building tailored SNEs on the desktop.  The MetMaker system under development uses the established MM5 model from NCAR [3] as the core numerical model.  GUIs that streamline the model setup and control procedure are being developed, automation of the model setup and control is being implemented, and adjoint methods for providing SNEs that meet specific constraints are being evaluated [2].3. MM5 Graphical User InterfaceThe MM5 consists of several pre-processing modules and an integration module.  The pre-processing modules are used to assimilate terrain and atmospheric data and interpolate that data onto grids that are ingested by the integration module.  Each module consists of an ascii text file known as a “deck”, which is edited manually to set parameters for the particular model run.  Configuration through editing of the “decks” is often difficult and tedious.  In order to alleviate this problem, TASC has developed a GUI used for configuring MM5 input and displaying MM5 output.TASC’s GUI accepts basic user input to configure and run the MM5. Using the GUI to configure the region of interest, (Fig. 1), the user selects a geographical domain by clicking on a global map, the map zooms in to a domain with a default extent, centered on the click location.  The zoomed region that is displayed corresponds to the “mother” or coarsest domain for the model run.  The user may then move the domain to a different geographic location and/or expand or contract the domain using the tools to the left of the map.  Once the user is satisfied with the location and extent of the mother domain, the user may configure subdomains or “nests”, which allow the model to be run at higher resolution within selected areas.  Nests may be created by “rubber banding” with the mouse (Fig. 2).  After creating a nest, the user may move, enlarge or contract the nest in the same manner as for the mother domain.  As subdomains are being configured, their geographic locations and extents are constantly updated and displayed in the middle of the panel.  In addition, the user may set other parameters relevant to the terrain module such as the resolution of the underlying terrain dataset to use for interpolation of terrain height to the nested grid.  The logical choices for those parameters are dynamically defaulted as each nest is created.  The interactive selection of domains significantly reduces configuration time.GUIs are available for all modules of the MM5.  Through all module GUIs, there are numerous parameters that can be set. All of the parameters have reasonable defaults, many of which will not need to be modified by the user for most model runs.  There are some parameters that can be set behind the scenes based on discrete modeling theory.  A simple example is the Courant condition that permits an intelligent choice of a time step based on the domain’s spatial resolution. The user selects initialization data in the analysis module.  The model may be initialized with archived gridded datasets, many of which are available from MEL (i.e., NOGAPS).  In the future, we expect that the Weather Scenario Generator will be used as a tool for finding initialization data that closely meet user needs.The View Model Output (VMO) module has been developed as a visualization tool for MM5 output (Fig. 3).  VMO is designed for quick, interactive production of model output charts. VMO has the ability to plot up to 4 panels at once through simple configuration within the GUI.  It can plot horizontal and vertical slices through the model output as well as one-dimensional plots such as vertical temperature profiles in skew-T, log-P diagrams. VMO can display fields as they are output by the model.  Thus, the user does not need to wait until the model run has completed to view the data.  We believe this will be very useful in allowing users to monitor their SNE as it is being generated, and as requirements are being met through steering functions. The main interface (Fig. 4) is used to execute the MM5 modules.  Clicking the run button on this panel begins the model run.  The estimated run time for a particular configuration is displayed and a status bar, indicating the time remaining in the model run, is updated as the model executes.  The user has the option of omitting modules that he does not wish to run.  In addition, model configurations can be saved and loaded.It is important to note that while the GUIs support configuration of all MM5 parameters, all parameters except the region of interest have defaults.  Thus, the user can execute an MM5 configuration simply by selecting a region of interest and clicking “Run all Model Stages” on the main MM5 interface.Although the GUIs will be very beneficial in configuring and executing the MM5, there are times when a user may wish to run MM5 from the command line.  This may be beneficial for remote users who find that using the GUIs over a network is inefficient.  In this case, users may execute scenarios that have been configured and saved by the GUI by simply typing a program name followed by a scenario name at a unix prompt.  In addition, users may edit saved scenarios by editing ascii configuration files. 4. SummaryNumerical weather modeling provides the ability for a completely new and unique capability for constructing weather databases.  Realistic weather databases using the MM5 mesoscale model can be generated on-demand at much higher resolution than those available from archived data sources.  Further, through nudging and more sophisticated four-dimensional variational data assimilation techniques, the model output can be steered to meet the end user’s needs.  TASC’s graphical user interface greatly simplifies configuration of the MM5 and visualization of its output.  The intelligence within the GUI allows users without meteorological backgrounds to run numerical weather prediction models.  The scientific validity and realism of synthetic natural environments will be much improved with the integration of numerical weather modeling with TAOS.3. References[1]	Dailey, P.S., T. A. Hutchinson, M. J. Longfritz, R. A. Reynolds, and D. Sherer: “Using MM5 to Create Synthetic Environments for Military Training and Analysis” MM5 User’s Workshop, 1998.[2]	Whitney, D., D. Z. Sherer, R. A. Reynolds, and P. Dailey: “Virtual Natural Environments for the 21st Century”  I/ITSEC98, December 1998.[3]	Grell, G. A., J. Dudhia, and D. R. Stauffer, 1995: A description of the fifth generation Penn State/NCAR mesoscale model (MM5).  NCAR Technical Note TN-398+STR, 122 pp.Author BiographyTODD A. HUTCHINSON is an atmospheric scientist with a M. S. in Meteorology from the University of Oklahoma.  Todd has worked on various numerical prediction efforts and several modeling and simulation activities.PETER S. DAILEY is an atmospheric scientist and the technical lead for atmospheric data integration on the TAOS and STOW projects. Dr. Dailey received a B.A. and B.A.S. from the University of Pennsylvania, and a M.S. and Ph. D. from the University of California at Los Angeles.ROBERT A. REYNOLDS is a Principal Member of the Technical Staff at TASC.  He is the system architect and lead developer of the Total Oceanographic, Atmospheric, and Space (TAOS) system, and is supporting the design and development of the MetMaker GUI and visualization subsystem.DANA Z. SHERER is the technical director for TASC's Environmental Modeling & Simulation programs.  These include the TAOS (Total Atmosphere Ocean Space) Environmental Services System and related global METOC database development, DARPA-sponsored JETS (JSIMS Environmental Tailoring System), SPACECOM-sponsored support of PSM (Portable Space Model), and Air Force-sponsored integration of TAOS with AES (Atmospheric Effects Server) for wargaming exercises.  Ms. Sherer is directing TASC-internal R&D of a "user friendly" desktop numerical weather modeling system, based on MM5, that will provide tailored weather environments for distributed interoperating simulators.  She has been with TASC for 10 years, working in the areas of systems engineering, distributed simulation, data analysis and scientific data visualization.  She received her BS and MS degrees in Systems and Control Engineering from Case Western Reserve University.JAMES R. STAUDINGER is a software engineer with a M.E. in Electrical Engineering from Rensselaer Polytechnic Institute. He has designed and developed various software projects including real time systems, computer graphics, and web-based  applications.Fig.4.  The main interface to the MM5 GUI.Fig. 1. TASC’s graphical user interface used for selecting the MM5 region of interest (global view).Fig. 3. View Model Ouput GUI.Fig. 2.  Graphical user interface for selecting the region of interest.  Several nests are shown.