Six-Dimensional Triangulated Irregular Networks for METOC Data RepresentationRobert A. ReynoldsNorthrop Grumman Information Technology55 Walkers Brook Dr.Reading, MA 01867781-205-7579 HYPERLINK "mailto:robert.reynolds@ngc.com" robert.reynolds@ngc.comKeywords:OASES, HLA, environment, server, METOC, triangular, mesh, synchronization, protocol, frequency, effects, profile, unstructured, TIN, EDCS, representation, SNEABSTRACT:  Through investments by DMSO and the Army M&S community, the Ocean, Atmosphere and Space Environmental Services (OASES) system has continued to expand into new territory.  This paper provides an overview of a number of new OASES system functions and the requirements that motivated their development.  Well known as a system of middleware for converting  five-dimensional (3 space, time, environmental attribute index) numerical weather forecasts into dynamic HLA objects, OASES now provides support for environmental attributes which are frequency dependent.  Frequency-dependent attributes such as Extinction Coefficient and Radiance, crucial to sensor modeling, can now be ingested, transformed, visualized and published by OASES for any band defined by the SEDRIS EDCS.  The available OASES spatial data representations, previously based on combinations of rectangular and curvilinear grids, have been expanded to include a variant of a Triangulated Irregular Network (TIN) referred to as an Unstructured Profile Set (UPS).  As described in the paper, the UPS representation allows complex METOC environments to be constructed which do not have the multi-value and multi-representational problems associated with the previous approach.  Additional work reported on within the paper includes the development of support in OASES for simulation protocols designed to automate Federation configuration and execution from a central workstation, and extensive improvements to the OASES Operations GUI.OverviewThis paper describes recent improvements made to the Ocean, Atmosphere and Space (OAS) Environmental Services (OASES) system in three specific functional areas.  First, a new spatial METOC data representation has been identified that avoids the “multiple-value” problem that occurs when OAS data grids overlap.  The generalized representation, which shares some of the properties of the Triangulated Irregular Network (TIN) commonly used to model terrain, also simplifies client simulation development by avoiding concurrent publication of multiple spatial representations (e.g., mixed rectangular and curvilinear grids).  Support for this more general representation, referred to as an Unstructured Profile Set (UPS), is now provided by OASES as described in Section 2.Section 3 describes work done on the OASES system in the second functional area: support for frequency-dependent state variables. Driven by a requirement to support a FOM that includes Extinction Coefficient, Radiance and Precipitation Backscatter atmospheric attributes for a set of  EM bands which are left unspecified (versus explicitly enumerated such as was done in the OAS data model for the OneSAF Objective System), frequency is now recognized as the “sixth dimension” of an environmental scenario, augmenting the standard 3-space, time and enumerated state variable axes that account for the “Five” in the Environmental Scenario Generator’s (ESG’s) Five Dimensional Representation (FDR) and for the “5” in the  popular Vis-5D visualization tool.Finally, the OASES system has been extended to support a synchronization protocol, implemented through a combination of HLA synchronization points and specialized Interactions, that provides a richer set of Federation control functions than are provided by the HLA Federation Management Services alone.  Specifically, this synchronization protocol allows a simulation exercise manager to command the Federation not only to Pause, Resume, Save and Restore, but also to Configure, Reset, Reconfigure and Shut Down.  This protocol and the state machine that implements it within OASES are described in Section 4.A Single-Valued Spatial Data RepresentationAs described in [1], OASES has to-date constructed a synthetic environment through the publication of data objects that directly encapsulate numerical model output grids.  For reasons given in the next section, it is often the case that these model grids spatially overlap. The result is that, at least in principle, an entity subscribing to these grids must decide which grid to query in the overlap regions; the published environment can be considered as being multi-valued in these regions.  This is generally an undesirable state of affairs because it opens the door to interoperability problems if Federates use different rules and/or choose different algorithms for querying the OAS state in the overlap regions.  Better would be for the OAS Federate (OASES) and/or the Subject Matter Experts (SMEs) providing input to OASES, to merge the data from multiple models in the overlap regions to produce single-valued OAS fields.The multi-value problem and the approach selected to resolve it are much easier discussed by focusing on two specific use cases.  These use cases, one set in the ocean domain  and the second in the atmosphere,  in fact represent the cases of immediate, near-term interest for application.Ocean Acoustics Use CaseDue to differences in ocean physics, spatial and temporal dynamics, and especially to the geometry of the land-sea interface that establishes boundary conditions for the numerical models, the acoustic properties of the near-shore and deep-water ocean environments are modeled separately, using different models.  This use case, first encountered while developing a combined littoral and open-ocean model for the Environment Federation experiment(s) [1], and later encountered during Millenium Challenge 2002, involves the deep water Modular Ocean Data Assimulation System (MODAS) and the Estuarian Coastal Ocean Model (ECOM).  The model output grids overlap horizontally as illustrated in Figure 1; note that the deep-water, rectangular grid extends all the way to the shore although this is not clear from the figure.To date OASES has provided coverage of the full ocean playbox simply by publishing both the low-resolution rectangular grid as well as the high-resolution curvlinear grid used for the littoral zone.  Not only does this result in a multi-valued overlap region, but the subscribing simulation must manage separate object reflections, typically requiring separate data structures and query algorithms.  The central question is whether both data sets can be provided using a single data organization – something that supports both rectangular and curvilinear grids through a more complex mesh geometry.Figure 1:  ECOM and MODAS Horizontal Computational GridsTo motivate the selected mesh geometry, it is worth considering the vertical grids that are used by the ECOM and MODAS models; these are depicted in Figure 2.  ECOM defines a bottom-following depth fraction vertical coordinate which samples the vertical at an equal  number of levels at each horizontal location, but with a vertical spacing that varies from profile to profile.  MODAS uses a depth coordinate, with predefined levels at unequal spacing, but with no horizontal variation in the vertical grid.  When the vertical grid structure is considered, one begins to recognize that one of the few common features between the ECOM and MODAS gridding systems is that all grid points below the ocean surface lie along vertical profiles defined by the models’ horizontal grid points.  It turns out that the atmospheric use case exhibits a similar spatial structure.Figure 2:  ECOM and MODAS Vertical Computational GridsAtmospheric Use CaseFor the atmospheric domain, it is common for numerical modelers to define multiple nested grids that telescope down from a low-resolution grid covering the full spatial domain to one or more high resolution grids covering smaller regions where higher fidelity wheather forecasts are desired.  Figure 3 illustrates a typical case; this case is based on a scenario developed by the Environment Federation and described in [1]. SHAPE  \* MERGEFORMAT Figure 3:  Nested Horizontal GridThe multi-value problem manifests itself in the case of nested atmospheric grids because each higher resolution grid completely overlays the grid of the next lower resolution.  Although it isn’t made clear by the figure, where the white grid underlies the yellow grid, there are two values for all computed atmospheric properties at each white gridpoint.  And in the area which is the intersection of the spatial domains of all three grids – that is, in the domain of the red grid – there are three values associated with every white gridpoint.  While it is in principle easy to establish a rule for querying the nested dataset such that the highest resolution data is always used when more than one value exists at the queried location, it is still desirable to generate an SNE that is unambiguous (single-valued) and which does not require the client simulation to have to manage multiple Object reflections for the same atmospheric attribute(s).The vertical structure of the atmospheric use case, illustrated in Figure 4, is somewhat simpler than that of the ocean use case.  All nests typically employ the same vertical levels and spacings; all that changes as one traverses the horizontal domain is the relative horizontal spacing of the vertical profiles that comprise the nested dataset.  But because a complex atmospheric dataset can be decomposed as a two-dimensional array of 1D vertical profiles, much as the complex ocean dataset represented by the ECOM/MODAS union  can be, the search for a generalized spatial representation focuses on the vertical profile as the fundamental data element. SHAPE  \* MERGEFORMAT Figure 4:  Atmospheric Vertical GridUnstructured Profile SetsThe ocean use case drives the requirements for the generalized representation through the need to support model data comprised of a collection of vertical profiles which are 1) located at irregularly spaced lat/lons in order to accommodate both curvilinear and rectanguler gridpoints and 2) allow for horizontal variation in both the number of levels and their vertical spacings.  A generalized spatial mesh defined by exactly the union of the grid points associated with an arbitrary collection of vertical profiles is given the name Unstructured Profile Set (UPS) and is recognized to be general enough to represent both the ocean and atmosphere use cases.OASES has been extended to support the UPS representation.   While work is in progress on generating data using this representation external-to and upstream-of OASES – specifically within the Environmental Scenario Generator (ESG) – as an interim measure the OASES Ingestor is now capable of importing both rectangular and curvilinear datasets into the UPS representation.  If the target OASES scenario already includes UPS Fields for a state variable being imported, then these Fields are augmented through a simple unionization of the input profiles with the existing profiles.TINs for METOC?The UPS representation as defined herein does not attempt to impose any structure on the locations that mark the profile locations.  In principal it should be straightforward to generate a triangular mesh for these locations, using e.g., the DeLaunay algorithm.  This additional layer of geometric information would establish the vertices and sides of the triangles comprising a triangular irregular network, or TIN.  But the question that we pose at this junction is “What value would this add?”.  All profile locations – being defined purely by their longitude and latitude –  lie on the reference ellipsoid, so the triangular mesh does not provide a model of any interesting physical surface such as terrain TINs do.  Nor have the investigators seen any reason to consider generating triangular meshes that connect points at different vertical levels, effectively extending the TIN concept into a third dimension to produce, perhaps, a space-filling lattice of triangular pyramids.  The real question of course is “What do the client Federates require in order to access and use the UPS Fields owned by OASES?”  We turn attention to the OASES SOM and what is required to extend it to support UPS data.UPS Fields and the OASES SOMIn principle, UPS Fields of, say, Water Temperature and Salinity could be published to the Acoustic Transmission Loss (ATLoS) Federate using a straightforward extension of the existing WaterColumnCurvilinear Object class.  The attributes that define this Object class include the full list of the double values for the latitudes and longitudes of the grid – resulting in very large object sizes – because there is no known method for defining a curvilinear grid in a more concise or compressed way.  Hence, a new “WaterColumnUPS” Object class could inherit the WaterColumnCurvilinear horizontal grid attributes directly.  However, the WaterColumnUPS class would require additional large attributes for conveying the horizontally-varying vertical grid locations.  The resultant objects would be so large that subdivision of the published Field would almost certainly be required, at least within Federations running in Connectionless Mode [2]; the problem of UPS Field reassembly faced by the subscribing Federates would then raise the question as to whether the UPS representation offers much practical improvement over the previous approach of publishing two separate representations.Fortunately, there is a much simpler approach to the problem of Sharing [3] a UPS-based METOC environment with the Federation.  As it happens, the current ATLoS implementation, which must support both rectangular grids and curvilinear grids, effectively decomposes all received gridded water column objects into vertical profiles.  These vertical profiles are then maintained and queried using an in-memory quad-tree data structure.  Furthermore, the representative simulation client for the atmospheric use case – the Nuclear, Chemical, Biological and Radiological (NCBR) Federate – actually favors an atmospheric SNE constructed as the union of the discrete VerticalProfile Objects supported by the  OASES SOM.  In fact, OASES was recently extended at the request of the Army’s Synthetic Environment Integration Testbed project to allow rectangularly gridded MET data from the 4DWX model to be published not as 3D WeatherGDC objects but as a collection of 1D VerticalProfile objects.  With ATLoS and NCBR representing existing, fielded client Federates to the complex METOC environments that result from merging, respectively, ECOM/MODAS datasets and 4DWX nested grids, the natural approach to publishing UPS Fields in OASES is to decompose the Fields into their constituent vertical profiles and to publish these profiles directly.  This is the approach currently being implemented.Frequency-Dependent FieldsIndependently of the work done on the generalized spatial representation described in the previous section, OASES has been generalized to support publication of arbitrary frequency-dependent state variables.  These variables, limited initially to atmospheric Extinction Coefficient, Radiance and Precipitation Backscatter, collectively represent environmental properties that affect the transfer of signals and radiative energy through a material or medium.The requirement to support general frequency-dependence for published atmospheric quantities traces to a requirement to support publication of the Simulation Object Model (SOM) components identified in Figure 5.  By defining the EMBand Complex Data Type (CDT) through an arbitrary minimum and maximum frequency, the model is not bound to a finite, named set of bands as is the OOS AOS EDM.  That is, the EMBand CDT of Figure 5 is not bound to an enumeration.  This presented a challenge to any OASES implementation that might support internal storage and subsequent publication of objects labeled only by their min/max band frequencies, because inevitably any frequency-dependent source data – as provided by an external model – would almost certainly be labeled with some type of enumeration to distinguish one frequency band from another.  How best then to identify frequency bands internal to OASES?The compromise arrived at was to embrace the most comprehensive enumeration available, which was found to be that defined by the EAC_EM_Band enumeration of the Environmental Data Coding Standard (EDCS) of the Synthetic Environment Data Representation and Interchange Specification (SEDRIS).  The EAC_EM_Band enumeration – available online at  HYPERLINK "http://www.sedris.org/edcs.htm" http://www.sedris.org/edcs.htm -- includes 44 bands ranging from UltraLow Frequency to Gamma Ray, and includes the conventional minimum and maximum frequency values associated with each band.  The OASES internal object model, and in particular its state variable identification scheme, has been expanded to support the EAC_EM_Band enumeration, such that state variable mapping tables can be established for the conversion of external identifiers (e.g., GRIB extensions or NetCDF labels) to the EDCS standard.  In practice this is likely to prove all that should ever be required, but in principle the EMBand CDT allows for the definition of bands which could encompass and/or overlap with arbitrary (nameless) subsets of the bands defined by the EDCS.Note that an external provider for the data required to populate the SOM elements shown in Figure 5 has not yet been identified, and in the interim a GUI-driven synthetic data generator has been developed for OASES capable of creating frequency-dependent, enumerated and/or real-valued Fields of user-selected state variables on a user-specified spatial and temporal grid.A Synchronization ProtocolThe third functional area to be covered by this paper concerns a synchronization protocol for coordinating the state of a Federation execution with finer grained control than is available through sole use of the HLA Federation Management Services.  The protocol, developed by the Army’s Future Combat System (FCS) and documented in the FCS Simulation Environment (FSE) Software Architecture Description Document, is best illustrated in terms of the state transition diagram of Figure  6.  In the figure, the solid arrows represent state transitions that occur in response to external stimuli – specifically receipt of an Interaction or  in response to a remotely-invoked Federation Management Service – while the dotted arrows represent transitions that the Federate makes automatically once it has completed a designated task.In all cases, after a state transition a Federate sends a StateTransition Interaction, identifying the Federate and the state being transitioned to.  This allows a manager Federate to monitor the state of the Federation.The boxes in the figure identify nine states that a given Federate may be operating in:Ready – The Federate has been started and has joined the FederationStandby – the Federate has initialized its data structures and local databases and is waiting for exercise-specific initialization instructions from the Federation.Initialized – a transitory state achieved once all initialization is complete and the Federate is ready to execute.  Once achieved and announced through the send of a StateTransition Interaction, the Federate automatically transitions to the Paused state.Paused – as indicated in Figure 6, this state represents the launch point for all post-initialization activities.  It is achieved through a Federation-wide synchronization point bearing with the label Pause.Executing – the normal state associated with a running simulation, with the Federate advancing time, updating/reflecting Objects and sending/receiving Interactions.  It is entered from Paused through a Federation-wide synchronization point with the label Execute.Saving – this state is entered when the Federate is directed to save state via a Federation Management Save callback.  Once the save is completed, the Federate automatically transitions back to the Paused state. Figure 5:  Atmospheric Propagation BOMResetting – this state is achieved through a Federation-wide synchronization point with label Reset.  The Federate frees all memory and resources associated with the current execution context and returns itself to the Ready state, where it resets its internal state and transitions to Standby to wait for new initialization instructions.Restoring – this state is entered from Standby when the Federation Management Restore callback is invoked.  Once the restore is complete, the Federate automatically transitions to Initialized.Stopping – this state is entered either through the action of a local operator or as a result of a Federation-wide synchronization point with the label Stop.In summary, to support this synchronization protocol, a Federate is required to 1) respond to announcements of synchronization points, recognizing and acting on the labels Pause, Execute, Reset and Stop, 2) respond to Federation Management commands to Save and Restore, and 3) send the StateTransition Interaction to notify manager Federates of the current state of the Federate.  In addition, the Federate must support any additional Interactions required to convey the details of the simulation exercise’s initial conditions, including terrain database, force laydown, weather scenario and time-of-day.  The considerable benefit to the simulation exercise coordinators is the ability to perform Federation wide initial configuration and startup in a uniform and controlled manner, and also to perform a Federation-wide reset and reconfiguration from a central workstation through a manager Federate.Figure 6: Federate State Transition DiagramSummary and PlansThe extensions to OASES described by this paper are in various states of completion.  Support for the UPS spatial representation as described in Section 2 will be included in a future release of OASES, circa March 2006.  Support for frequency-dependent state variables as described in Section 3 is already available in the recent (December 2005) 2.3.x release.  The synchronization protocol described in Section 4 is being developed incrementally, and the 2.3.x implementation does not yet support the Save, Restore and Reset functions.AcknowledgementsThe work described in this paper has been a collaborative effort and the author would like to acknowledge the contributions of Bill Smith and Christopher Scannell of the NRL, Washington DC, Steve Lowe of the ESG Project and Doug Clark of DMSO.ReferencesReynolds, R.A., Iskenderian, H, Ouzts, S.O. Using Multiple Representations and Resolutions to Compose Simulated METOC Environments, Proceedings of the Spring 2002 Simulation Interoperability Workshop, 02S-SIW-031, March 2002, Orlando FL.Reynolds, R.A. and Scannell, C.G, Supporting the Transfer of Large Environmental Data Objects Over a Connectionless RTI, Proceedings of the Fall 2003 Simulation Interoperability Workshop, 03F-SIW-088, September 2003, Orlando FL.Birkel, P.A. et. al, Breaching the M&S METOC Barrier: The Worldwide, Low-Resolution METOC Database, Proceedings of the Spring 1999 Simulation Interoperability Workshop, 99S-SIW-015, April 1999, Orlando FL.Author BiographyROBERT A. REYNOLDS is a Principal Engineer at Northrop Grumman Information Technology, Defense Enterprise Solutions, and has been the system architect and lead developer for the OASES system and its predecessor TAOS.  His primary professional interests are in the areas of software and simulation engineering, object-oriented modeling, visualization, and synthetic environments.  He has a BS in Physics from the Massachusetts Institute of Technology and an MS in Nuclear Engineering from Carnegie-Mellon University. The OOS AOS EDM recognizes only Visible, Near IR, Middle IR and Far IR bands for atmospheric attenuation modeling.PAGE  PAGE  1PAGE  PAGE  5