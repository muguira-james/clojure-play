The Ultra High Resolution Building Editor for OneSAFJaeson MunroScience Applications International Corporation12901 Science DriveOrlando, FL 32826-3014321-235-7703 HYPERLINK "mailto:Jaeson.Munro@saic.com" Jaeson.Munro@saic.comKeywords:Terrain, Editor, OneSAF, Buildings, Java, UHRB, XML, SNEABSTRACT: Because of its emphasis on the simulation of MOUT missions, the Army’s One Semi-Automated Forces (OneSAF) Objective System (OOS) needs to have a capability for extensive representation of buildings and building interiors.  Buildings and building interiors can add considerable density and complexity to both the environment databases and the runtime simulation software.  The OneSAF Environment Data Model (EDM), a specification for environmental content representation in OneSAF, defines the concept of Ultra-High resolution buildings (UHRBs) and specifies how they are to account for building interior geometry and features.  UHRBs in OneSAF bear rich and detailed attribution, specifically coded to help with spatial and tactical reasoning.	The Ultra High Resolution Building (UHRB) Editor is a OneSAF tool that provides the user a GUI driven means of creating UHRB models quickly and easily.  The UHRBmodel being edited, can be viewed in a 3D display, which is provided by the editor.  When a UHRB is created it can be exported to an XML file, which is tailored to include all information required by the OOS Environment Runtime Component (ERC) to support efficient reasoning and geometric and spatial search.  This XML file is later used by ERC to place buildings on the terrain.    In the future, the UHRB editor will be able to import other formats, such as SEDRIS and CAD formats.  The Editor itself is written in Java.	Buildings that have been defined in the editor will contain all components and attributes of a UHRB, as defined by the EDM.  This includes walls, apertures, enclosures, roofs, and staircases.  The hierarchy of these components in relation to the total UHRB is represented by the editor’s use of a tree structure.    A UHRB contains one or more floor levels.   A floor level contains zero or more walls.   Walls may contain apertures, and so on. Copy and paste capability allows a user copy one wall and duplicate it on another floor level.  Also, an entire floor level can be copied and pasted as a new floor level.  This is a key feature for creating a UHRB quickly.  Zoom and rotation capability exists within the 3D view of the editor, to allow the user to view a UHRB from any angle and at any distance.What is a UHRB, and why is it necessary for OneSAF?What is OneSAF?From the onesaf.org web page: “OneSAF will be a composable, next generation CGF that can represent a full range of operations, systems, and control process from individual combatant and platform to battalion level, with a variable level of fidelity that supports all modeling and simulation (M&S) domains. It will accurately and effectively represent specific activities of ground warfare (engagement and maneuver), Command, Control, Communications, Computers, and Intelligence (C4I), combat support, and combat service support. It will also employ appropriate representations of the physical environment and its effect on simulated activities and behaviors.”Defining a UHRBFor OneSAF, medium resolution buildings are defined to be buildings with only an exterior shell.  While high resolution buildings have an exterior shell with apertures.  An Ultra High Resolution Building (UHRB) models the full interior of a building. The UHRB ComponentsFor a visual representation of the hierarchal composition of the UHRB components, please reference the UHRB hierarchy in figure 1.2.Each UHRB contains one or more Floor Levels.  A Floor Level is what is commonly referred to as a “floor” or “story” in a multiple floor building.  So a four-story building would have four Floor Levels as a UHRB. Each Floor Level contains one or more rooms, and zero or more walls and fixtures.  A basement or a tunnel can be represented by a Floor Level that is below ground level.  These underground Floor Levels contain walls with apertures that provide access to other building components.Each UHRB also contains at least one roof.  Roofs can be represented in multiple profiles.  Examples are flat or peaked roofs.  They also contain material attributes, which is useful for a simulation needing to determine if a roof can withhold the weight of a rotary wing aircraft.  A roof may contain apertures in the form of skylights.A UHRB may also contain elevators, staircases, and escalators.  These objects can be placed throughout the building and are key components needed to access multiple floor levels during a simulation.  An elevator is represented as an independent movable component that sits within an elevator shaft.  Staircases are static objects represented with detailed polygonal data.  They can be of multiple types, such as straight, “U” shape, or spiral.  Each staircase has an associated railing type.  Steps are also represented and contain material attributes.A Wall encompasses several different types of components, such as interior walls, exterior walls, and vertical partitions.  Each Wall consists of a polygon defined in 3-D space, which defines its location.  Additional attributes are Figure  SEQ Figure \* ARABIC 1.3 An example of a UHRB's hierarchydependent upon which type of wall it is.  A wall contains zero or more apertures.An Aperture is the general term used to describe several different component types.  Among these types are doors, windows, and breach holes.  Every Aperture also contains a polygon defined in 3-D space, as well as other attributes, which are dependent upon that attribute’s type.  For example, a door or window will have a material type associated with it, whereas a breach hole will not.  Doors contain an attribute which defines the movement of that door (hinged, sliding).  Windows may have an associated covering such as a screen or security bars. Any section of a Floor Level that is completely surrounded by walls along the floorline is designated as a Room; however, sections that are not completely surrounded may also be designated as rooms.  Each Room contains a floor type, a ceiling, and a lighting characterization, among other attributes.  The lighting attribute may be set to “brightly lit”, “dimly lit” or “no light”.  The Ceiling of each room may have an associated crawl space, which would exist in the area of a floor level that is above the ceiling.  The floor of each room has its own material type such as carpet, tile, wood, etc.A fixture is a term that is used to describe any miscellaneous component of a building, which will primarily function as merely an obstacle during a simulation.  These components include furniture and support columns.  Furniture may be moveable or fixed.  A Fixtures location is defined by a bounding box.Each Floor Level may contain its own air duct system.  This duct system includes duct walls, ventilation shafts and ventilation openings.The Need for Ultra High ResolutionThe One Semi-Automated Forces (OneSAF) Objective System (OOS) has multiple requirements to support for Military Operations on Urban Terrain(MOUT) missions.  The ability to have infantry clear a building has become a much-needed capability for modeling and simulation training.  Examples of required capabilities include:Ability to enter a building on any floor (i.e. through a window or from the roof)Ability to occupy the interior of a building without looking outAbility to clear a room or building with hand grenadesModeling of room-to-room fighting with accuracyAbility for entities to walk through buildings and access any floor levelAbility to move obstacles to clear passageways within a buildingAbility to see and shoot through windowsAbility to destroy individual components such as walls, doors, or windowsUltra high resolution is necessary in order to model full interiors that support these capabilities to assure the satisfaction of OneSAF requirements.Overview of the OneSAF UHRB EditorThe Ultra High Resolution Building (UHRB) Editor is a OneSAF tool that is used to create new UHRB models.  This tool can also be used to modify existing models.  Currently, the editor has the capability to import and export models in its own predefined format only.  This format uses XML.  The Environment Runtime Component (ERC), which is the software component that models the Synthetic Natural Environment (SNE) in OneSAF, places individual UHRB instances into the terrain, based on the models that it imports from these XML files. Future plans for the editor include supporting other formats, such as SEDRIS and CAD.  The editor provides the user a GUI driven means of creating UHRB models quickly and easily.  The editor also has a display capability, which  provides a three dimensional view of the UHRB being created.  The editor itself is written in Java.Editing CapabilitiesOn the most basic level, the UHRB Editor provides the capability to create new UHRB models and modify existing ones.  This entails the creation, modification and removal of any building component.  Using the editor, any component, which requires a polygon to define its location in 3-D space, can either be drawn by the user, thus making the task less tedious, or its coordinates can be defined manually, one vertex at a time, for polygons which might be special cases.  Examples of these polygons include a wall location defined by any polygon that is not completely vertical, or a polygon that represents any wall that is not four-sided.  Both the UHRB Editor and OneSAF ERC support any wall or aperture whose location is defined by any polygon in 3-D space. Walls, Doors, Windows, and Columns are all examples of building components that can be easily drawn by the user and added to a UHRB. As another means of allowing the user to create buildings quickly and easily, the editor also provides the capability to copy and paste some building components.  Entire Floor Levels can be copied and stacked on top of one another.  Each copy of a Floor Level contains a copy of all building components and their attributes, which were part of the original Floor Level.   The components include all Walls (as well as their respective doors, windows, etc), furniture, rooms, and support columns.  Therefore, when several floor levels need to be created which are very much similar to an existing floor level, the editors copy and paste capability can save the user a tremendous amount of time, especially if modeling tall buildings, such as a skyscraper.A UHRB model, which has been created, can be exported to XML.  This XML file is used as a means of transferring building models from the developer’s tool to the OneSAF system for use in simulation.  In addition, this XML file can also be imported back into the editor for future modifications.  The Three Dimensional UHRB viewThe UHRB Editor contains a three dimensional view to allow the user to visualize the building model.  This can be seen in Figure 2.  When a user adds a building component, or makes any visually apparent change to an existing component, the changes can be seen through the 3-D view automatically.  Walls are rendered in the viewer at their respective polygon locations.  The 3-D view also uses textures such as wood grain and cement block  to make the material type of each wall apparent.  Apertures, by default, are rendered as a “hole” in the surface which they belong to.  This can be changed, as any door or window can be shown as open or closed.  A closed aperture appears as a surface, bearing the texture of the aperture’s material type.The editor allows the user to zoom in and zoom out in the 3-D view.  Also this view can be rotated 360 degrees in the x-y plane, and rotated vertically, giving the user the ability to view all angles of the model.By default, all visually apparent building components are displayed as partially transparent for complete visibility of the entire model.   The user has the ability to change this setting.  Individual components can be rendered as completely opaque, completely transparent, or any degree in between.The Data Driven InfrastructureThe OneSAF Environment Data Model (EDM) is a standard representation that contains the detailed data structure of all feature models in a simulation environment.  It defines all building components that a UHRB may contain.  Furthermore, it defines which attributes these components have, as well as default values for these components whenever possible.In order to easily comply with the UHRB standards defined in the EDM, the UHRB Editor has implemented a data driven infrastructure.  Upon execution of the application, the editor uses information from XML files that contain the EDM standards for building components.   Therefore, any building component that is created or modified in the editor, will contain all attributes which are defined in the EDM for that component type.  Any changes made to the EDM, and subsequently the XML files, will be immediately reflected in the editor.  This allows new attributes to be added to building components within the editor, without adding any new Java code.Using the OneSAF UHRB EditorThe UHRB Editor can run on any system that supports Java 1.4.  In order to demonstrate how building models are designed with the UHRB Editor, the methods for using several key features of the editor are described here.  For a more comprehensive guide to using the editor, please refer to the OneSAF UHRB Editor User’s Guide.Creating a new UHRBWhen created, each UHRB is “empty” and contains no components.  A UHRB is populated by adding Floor Levels.  Other Components such as walls and fixtures are added to these Floor Levels (see figure 3.1).  All of these components combine to form a complete UHRB.Adding a Wall (Draw with mouse)Figure  SEQ Figure \* ARABIC 2 - The 3-D viewRight Click on the tree node, which represents the floor level or template to which the wall will be added.Select “Add Wall” from the submenu.Select “Draw With Mouse” from the next submenu.If necessary, change any of the default values for this wall at the bottom of the window.On the 2-D overhead display of the floor level, click and drag the mouse to form a line representing the wall.When a satisfactory floor line for the wall has been sketched, click “OK” to create this wall.A visual representation of the new wall will appear in the UHRB 3-D viewing window.Adding an aperture (Drawing with mouse) – illustrated in figure 3.3Right Click on the tree node, which represents the wall or floor to which the aperture will be added.Select “Add Aperture” from the submenu.Select “Draw With Mouse” from the next submenu.If necessary, change any of the default values for this aperture at the bottom of the window.Click and drag the mouse inside the bounds of the wall, which is shown on screen, to form the outline of the aperture.When a satisfactory outline for the aperture has been sketched, click “OK” to create this aperture.A visual representation of the open aperture will appear as part of its respective wall or floor in the UHRB viewing window.3.4 Using the Options MenuThe purpose of the Options window is to allow the user to adjust certain settings in the editor.  Currently, this includes grid spacing and wall transparency.  Figure 5 displays the Options window showing its selectable features.To pull up the Options window:Figure  SEQ Figure \* ARABIC 3.1 – Example editing:User has drawn six walls in a Floor LevelFigure 3.3 – Example editing: User has drawn a door inside a steel wallSelect “Edit” from the top menu.Select “Options” from the submenu.The options window will appear.Grid spacing:The locations of components which are drawn with a mouse may (if the user desires) be snapped into the closest increment of a grid.  The default setting is for the editor to automatically choose an appropriate value for the grid spacing.  If automatic grid spacing is disabled, the user may directly set the value of the grid spacing (in meters) in the options window.Transparency:The slider here may be adjusted to make the walls appear completely clear, completely opaque, or any degree in between.  The value for wall transparency is used for viewing purposes only, and does not affect the UHRB model which is created.Figure  SEQ Figure \* ARABIC 5 - Options windowConclusionIn order to satisfy the requirements of the OneSAF Objective System, which places an emphasis on the simulation of MOUT missions, buildings in OneSAF need to extensively represent full interiors.   The Ultra-High resolution building concept, as defined in the OneSAF Environmental Data Model, represents buildings and interiors in sufficient detail to meet the requirements.  	The components of a UHRB include walls, apertures, enclosures, roofs, staircases, and others.  The UHRB editor uses a tree structure to represent the hierarchy of these components as they are created.  Copy and paste capability makes creating a UHRB easier by allowing a user to copy any component, including entire floor levels, and create a duplicate in a different location.  The editor provides a 3-D display which can be used to view a UHRB model while its being edited.  The editor can export UHRB models in XML format.  These XML files are later used by ERC to place buildings on the terrain.  The idea behind the UHRB editor is to provide the user with a GUI driven means of creating UHRB models quickly and easily.