SimPed: a pedestrian simulation tool for large pedestrian areasWinnie DaamenDelft University of TechnologyDepartment of Civil EngineeringP.O. Box 5048 2600 GA Delft The Netherlands+31 15 27 85475, +31 15 27 83179w.daamen@ct.tudelft.nlKeywords:Pedestrian, simulation, architectureABSTRACT: Until recently, the design of large pedestrian areas, as transfer stations, airport terminals, shopping malls and inner district areas, was mostly based on rules of thumb. Due to the high costs of these projects, more insight is needed in the followings of the design on the behavior of the pedestrian. On the one hand, the (walking) comfort of the pedestrian needs to be sufficient and these areas need to be able to handle growing pedestrian flows in the future. On the other hand, project developers must keep their costs under control.To be able to evaluate a design quantitatively and to compare different designs on pedestrian comfort, Delft University of Technology, in co-operation with Holland Railconsult, developed a pedestrian simulation model, called SimPed. SimPed is able to visualize and quantify the effects of a layout design choice on the pattern of passenger flows though the pedestrian area. It is based on a distributed architecture, in which modules for input, simulation, animation, archive and analysis are connected.One of the characteristics of the model is its ability to model public transport processes and especially their influences on the pedestrian behavior (like transferring from a bus to a train, pedestrians buying tickets and passengers boarding trains). Therefore, the individual pedestrian can be distinguished in this model by making choices for his shortest routes and moving through the infrastructure. Concerning the visualization, two methods have been used: for decision-makers we developed a three dimensional animation, in which individual pedestrians are visible and congestion can be noticed by the appearance of many pedestrians on a small area. The other animation is more technical, indicating levels of service for the pedestrians by colors varying from green (comfortable) to red (very crowded).Using SimPed, we have already obtained better insight in the pedestrian behavior in the new plan for the inner city of Rotterdam, The Netherlands. We found possible bottlenecks in the design.IntroductionThe traditional way of designing transfer stations is based on rules of thumb. These rules convey many years of experience concerning the behavior of passengers in transfer stations. However, they only consider static situations. Until now, a scientific foundation for these rules has not yet been provided. Moreover, the dynamic behavior of pedestrians also needs to be taken into account to predict the impact of a station layout design in practice.Currently, timetable generation involves the application of approximations for the time people actually need to transfer. Different types of passengers, such as elderly people, or parents with children, need different transfer times. Adopting accurately estimated transfer times will both remove excessive waiting times from a timetable as well as reduce the probability for passengers to miss their connection, thereby increasing the traveler's comfort and the timetable’s reliability. Purpose of the researchIn association with Delft University of Technology, Holland Railconsult has developed the simulation tool SimPed to estimate both mean and variability of walking times incurred by transferring passengers and to visualize walking patterns inside transfer stations and other pedestrian areas. Simulation studies with this tool reveal levels of service for passengers in transfer stations. Requirements for the simulation toolThe requirements for SimPed can be divided into three categories, namely: requirements regarding the situations the tool can cope with, requirements regarding the dynamics in the pedestrian model and requirements regarding the performance.Different model situationsThe aim of this research is to model pedestrians, rolling stock and the interactions between them (i.e. access a train and egress from a train). Therefor, a generic architecture has to be developed, which can be extended with all other modes of transport. This tool needs to be applicable for different situations. For one, the tool needs to be sensitive for variations in spatial design, which also includes variations in the spatial form of the different areas. Secondly, variations in timetable or train frequencies having effects on the pedestrian flows in the station need to be possible and must be visible in the output of the tool. Then, variations in the type of trains stopping at the platform need to be taken into account, resulting in different times to get on and off the train and thus generating another pattern and headway of incoming passengers. Finally, we distinguish types of pedestrians with different behavior characteristics leading to different transfer times.General traffic characteristics of pedestrians will be adjusted to those of passengers in transfer stations and calibrated using Dutch empirical data (to be collected) in order to obtain an appropriate model for the Dutch situation. Model dynamicsBoth pedestrians and public transport facilities are part of dynamic processes. Interactions between pedestrians are explicitly modeled in microscopic models, where macroscopic models describe the characteristics of pedestrian flows. Both types of models will be included in the tool. Public transport facilities influence arrival and departure times of pedestrians and thus influence the resulting pedestrian flows and especially the times pedestrians spend in railway stations. Also, characteristics of the different rail vehicles influence the times pedestrians need to enter or exit it. All these public transport characteristics must be included in the tool.Model performance The simulation tool must be able to handle large transfer stations of at least 100,000 m2 area intended for walking purposes. Furthermore, it should be prepared for the presence of about 100,000 persons during the same period of time. Structure of the paperThis paper outlines the simulation tool which has been developed. Some technical and behavioral modeling details will also be discussed, such as the modeling of the pedestrian movements and the architecture of the total system. Purpose of the modelThe pedestrian model presented in this paper is a modeling tool to analyze the impacts of:station design and station layouttimetable design and platform allocation as part of the timetable anddesign and layout of large pedestrian areason pedestrian flow operations, to assess the performance of the transfer station in terms of bottleneck capacity, experienced level of service, and to determine the feasibility of the timetable.To this end, the behavior of pedestrians in unusual or seldom occurring layouts of rooms or larger walking areas needs to be described as well.Station design and layout assessmentThe simulation model can be applied to quantify the level of service of pedestrians while they are moving through the station and while they are waiting at the platform or in the hall. These situations can be simulated for existing stations, extensions of existing stations, stations under development and stations under design. The emphasis is at the spatial shapes of the station and the amount of space available for the passengers to move. Also, a person can perform activities at a transfer station, which are or are not related to transferring. Examples of these activities are buying a ticket, waiting for the train and shopping. The influences of these activities on the level of comfort of the transferring passengers are also taken into account, when they hinder other pedestrians while waiting for their turn.Timetable design and platform allocationTimetables or train frequencies have a substantial influence upon the level of service of transferring passengers and especially upon their waiting times within the station. High frequent trains in a regular pattern imply a low waiting time and less stress for the passengers to catch their train. Whenever the amount of passengers can not be coped with, not even with this high frequency, the level of service will lower quickly, which can lead to dangerous situations. When the supply of passengers does not justify high train frequencies, train services need to be tuned in order to create optimal transfers. These transfers need to be maintained in case of delay or other disturbances, which demands an intelligent train management system and possible non-optimal station platform occupations.Dynamics of pedestrian flowsAs mentioned before, the layout of a station building influences the behavior of passenger flows. But not only the layout of all the station, also the spatial form of a part of the station or even the layout of one room can influence the behavior of individual pedestrians. By modeling pedestrians microscopically, whereby the interactions between individuals are taken into account, influences of the spatial environment can be shown. However, this tool does not yet have this microscopic behavior model, but it uses macroscopic relations between density in the walking areas and pedestrian speeds. It does distinguish individual pedestrians to choose their routes through the infrastructure and to perform activities.Bottlenecks in a certain room, before an escalator or near an entrance or exit can already be found in the design phase and thus saving a lot of expenses.In short, SimPed is used to evaluate:the layout of (parts of) existing transfer stations,effects of extensions and/or adaptations of existing transfer stations,layout alternatives for newly developed stations,alternatives of and changes in different platform allocations,alternatives of and changes in different timetables andlayout alternatives for large pedestrian areas without connections to public transport.Modeling pedestrian flow operationsThe model will be used to quantify the effects of station layouts on pedestrians in a transfer station. Visualizing these effects helps to identify and to understand the causes for the presence of bottlenecks, long walking distances and large transfer times. The visualization is achieved in two ways: technical (indicating the level of service of a walkway) and three dimensional (three dimensional view with individual pedestrians). Furthermore, the model makes it possible to determine the effect of disruptions during operation of the timetable (delays and early arrivals of trains) on transfer times of passengers.In evaluating the resulting pedestrian flows, the model is considered as a black box, containing an assignment model, which assigns pedestrians to a network (see  REF _Ref2763078 \h Figure 1). Inputs for the assignment model are a network with different links and a table of pedestrian origins and destinations. The assignment model assigns pedestrians to routes optimal for the pedestrian (shortest in time). The route choice is based  on instantaneous information of the network. The behavior of the different types of pedestrians (tourists, workers, etc) is also taken into account in a separate behavior model. EMBED Word.Picture.8  Figure  SEQ Figure \* ARABIC 1: The pedestrian movement model including inputs and outputsDuring the simulation, the model performs the following activities repetitively:determining origins and destinations of the pedestrians present,assigning routes through the station network,calculating walking times based on the behavior models andexecuting situation updates and dynamic evaluations.The model will produce different walking routes used by the pedestrians. The behavior model can cause the situation that two pedestrians, having the same origin and destination and at the same time present in the model, choose different routes.  Also, walking times will be calculated by the model (means and standard deviations). From the number of pedestrians on a link, the mean available space for each pedestrian can be derived which, in turn, is an indication for the performance on the link. This quantity is expressed in a level of service. Low levels of service indicate the presence of congestion in the network (see Fruin  REF Fruin \h [1] and  REF _Ref2762808 \h Table 1).Table  SEQ Table \* ARABIC 1: Definitions of levels of service on walkwaysLevel of serviceColourDensity (m2 / ped)Intensity (ped/m/min)Speed (m/s)ADark green> 3.2< 231.30BLight green2.3 – 3.223 – 331.25CBright green1.4 – 2.333 – 491.15DYellow0.9 – 1.449 – 661.00EOrange0.5 – 0.966 – 820.70FRed< 0.5> 82Modeling and visualizing the dynamic behavior of pedestrians, especially at railway stations is relatively new. At transfer stations, people behave differently compared to normal circumstances (eg. they may be in a hurry to catch their train or they are milling about because they have missed it). Moreover, the walking conditions in stations differ substantially from those outside (higher densities of people, wider range of walking purposes and speeds). Therefore, the specific behavior of passengers in transfer stations needs to be studied.Modular structure of the simulation environmentThe model consists of several modules. The pedestrian module contains a theoretical behavior model for pedestrians. ArchitectureA software architecture has been designed to combine the different modules of the model. An overview of the designed simulation environment is given in  REF _Ref2763039 \h Figure 1. EMBED Word.Picture.8  Figure  SEQ Figure \* ARABIC 2: Overview of the simulation environmentThe simulation process can be divided in 3 phases:Initializing: all data is entered.Simulating: execution of the actual simulation.Analyzing: analysis of the results.InitialisingIn this phase, the model is drawn in SimInput. This application converts the drawn data to a database (Model Data), used by other applications. This data consists of the characteristics of the infrastructure (as length, width and spatial form), the characteristics of the pedestrian types (as free speed and familiarity with the environment), characteristics of the public transport vehicles (as length, number and width of doors) and origins and destinations of both pedestrians and public transport vehicles in pedestrian generators and timetables.Then, information on the simulation to be executed is entered in SimControl. This data is also saved in a database (Control Data) and consists of among other things the models to be simulated, the applications with which the simulation is executed and the length of the simulation.SimulatingThe simulation is started in SimControl. Then, SimPed is initialized. A ‘ready-to-go’ message is sent back to SimControl. SimControl then starts SimAnimation (if required) and SimArchive. Both applications initialize and return a ‘ready-to-go’ message. SimControl gives a ‘Start’ signal to SimPed, which starts generating pedestrians. Produced data is sent by SimPed through an application for the distribution of the messages called SimDistribution to SimAnimation and SimArchive. SimAnimation visualises its messages, so the user can view the process and the progress of the simulation. SimArchive registers the data in the messages into two databases. The first one (Results Data) contains all results and is used for the analysis of this simulation. The second one (animation data) contains a stream file, with all data necessary for animation. It is some kind of film, which allows the user after the simulation has been executed, to look at some parts of it. Also, these films can be used for presentations.AnalysingThe data produced by the simulation are stored in the results database. These data are analyzed via the application SimAnalysis. This application consists of forms in MS Access, which calculate for example mean walking times and routes of pedestrians. Also, SimAnalysis produces diagrams and overviews in Excel of for example the progress of the number of pedestrians in some part of the infrastructure over time, thus indicating the level of service for a pedestrian over the time in this part of the infrastructure. Because of the openness of the data structure, all different kinds of diagrams and graphs can be produced, suited for the actual simulation.SimInputThe model is drawn in SimInput. SimInput is based on a graphical library and behaves like a drawing tool. Both the infrastructure and the origins and destinations of the pedestrians can be entered with this tool. We distinguish the following infrastructure elements:Walkways. This is the area pedestrians walk on. From each walkway we know the number of pedestrians present. Pedestrian density is homogeneous on the walkways, so the infrastructure is divided into smaller areas.Stairs. Stairs are in fact the same elements as walkways, with the same pedestrian behavior. They only differ in the speed for both the upwards and downwards direction.Escalators. We distinguish pedestrians walking on the escalator and pedestrians just standing still. Furthermore, the next pedestrian can only step on the escalator when a new step has arrived.Elevators. Elevators are independent objects in the simulation tool. They move up and down, based on the demand of the pedestrians. Pedestrians can be given the characteristic of being disabled, so they can not use stairs or escalators. In general, ‘normal’ pedestrians do not use the lift, except when it is the only opportunity to go to another level.Connections. Connections are used to indicate the locations a pedestrian can go from one walkway to another. This can be free space (on a platform for example), but also a door or a turnstile. These last elements can also cause some delay (pedestrians need to open the door before they can pass).Activities. A pedestrian can perform activities in a station. These can be either station related or not. Station related activities are for example buying a ticket, where a not station related activity is for example buying a paper.  Locations where activities can be performed are indicated in the model and for each location the type of activity is indicated. The pedestrian then chooses those locations to perform his activity that minimize his total walking time.Tracks. Tracks can be for railroad traffic, but also for light rail, metros and buses. Its function is to indicate the stopping place of the vehicles, in order to determine the locations of the doors. These doors are the origins (egressing passengers) and destinations (boarding and transferring passengers) of the pedestrians.To determine the moments passengers enter and leave the model, a timetable can be defined, as is shown in  REF _Ref1105680 \h Figure 3.Figure  SEQ Figure \* ARABIC 3: TimetableThe tracks are set along the vertical axis, whereas the time is set along the horizontal axis. Each blue line in the timetable indicates a train or light rail vehicle. It starts at the moment a vehicle has been planned to arrive along the platform and is ready to open its doors and it ends at its planned departure time. For each train the rolling stock can be determined. Especially in the Netherlands many different types of rolling stock are used, all having other doors at different locations. The rolling stock characteristics concern length of the vehicle, number of cars, number and location of doors and characteristics of each door such as door width and height above the platform. For each train the number of boarding passengers and their origins and the number of egressing passengers and their destinations is specified. A destination can also be another train, this way creating transferring passengers.The simulation tool can also be applied in areas without public transport, for example in stadiums, in airports and in shopping centers. Origins and destinations of pedestrians are then not determined by a timetable. Therefor, we can define entrance and exit points in the model, indicating locations where pedestrians can enter or leave the model. For each pedestrian flow in the model, we can define a generator, indicating the number of pedestrians walking from a specified origin to a specified destination during a given time period.For each pedestrian flow an origin and destination is known. On their way, pedestrians can perform activities. For each flow is specified what activities the pedestrians will perform and the number of pedestrians actually performing them. For example, 40% of passengers coming from outside the station going to the train to Amsterdam first have to buy a ticket and, when they have time left, they will buy a newspaper.For each pedestrian flow also characteristics of pedestrians can be indicated. These are their free speed (the speed they want to walk with when no one is around) and their familiarity with the station (when pedestrians are familiar, they walk directly to their destination, whereas when they are not familiar, they first look for additional information).SimControlAfter the input of the model has been completed, the simulation can be started. The control of the simulation is done by SimControl. SimControl is an application designed in Visual C++. Its interface consists of several tab pages (see  REF _Ref2740491 \h Figure 4).Figure  SEQ Figure \* ARABIC 4 : User interface of SimControlIn SimControl, the user can define configurations that can be simulated. Each configuration consists of a model, a parameter set and a set of executables and can be entered under the tab ‘Configurations’. The model is the model drawn in SimInput, determining origins and destinations of the pedestrians and the infrastructure network pedestrians walk through. On the page under the tab ‘Models’ the path to this file can be set.The parameter set (on the tab ‘Parameters’) consists of parameters concerning the simulation itself (the number of replications to get statistically confident results), the animation (to directly start animating, speed of the animation) and the archive (when a logging file has to be made to replay the animation after the simulation has ended, the start time and stop time of these loggings have to be specified). Finally, in the set of executables the user indicates the version of SimPed he likes to run with, whether he likes an animation or not, what executable can be used to archive the data and the location of the results database.When the configuration is completed, the user can select one or more configurations to be executed, where each configuration stands for one simulation. It is possible to execute several configurations in succession. Finally, the user presses the Simulate-button (see  REF _Ref2740491 \h Figure 4) and all selected configurations are executed, one after another.CommunicationWhen the user starts simulating a configuration, communication between the different applications start. Each application (archive, kernel, animation) can run on a separate computer. To copy all executables to the right computer and to start these executables, the service SimStart has been designed. The different applications need to communicate (synchronize, sending results, …). This communication is directed by the service SimDistribution. SimDistribution holds a list of which executables are on which computer; it checks whether they are still able to receive and send messages and it decides which message has to go where. Also, SimDistribution synchronizes the starting process and stops applications when the user indicates this in SimControl or when the simulation has ended.In case of irregularities (computers going down, failures in the software) these must be made known to the user, even in the case that the connection has been lost. To collect these messages, a named service SimLog has been designed, which is able to mention these messages to SimControl which at its turn shows the messages to the user.SimPedThe actual calculations will be performed by SimPed. The architecture is so general, different types of simulation applications are supported. At the moment, we are only doing simulations of pedestrians within this architecture and therefor we developed SimPed. After the start of a simulation, SimPed starts to read the model from the database created by SimInput. SimPed constructs a network from the infrastructure and calculates shortest routes in this network. This is the end of the initialization stage.After SimControl has mentioned that also SimArchive and, when needed, SimAnimation have initialized, SimPed starts generating public transport vehicles and pedestrians. All pedestrians generated by a generator are added to a list and wait until they can enter the model (at their generation time). All public transport vehicles are also added to a list and wait until they are planned to arrive at the platform. A public transport vehicle knows the number of pedestrians to board and also knows their origins. Then, it calculates the time it takes pedestrians to walk from their origin to the vehicle, adds some spare time (time pedestrians arrive to early at the platform in order not to miss the vehicle) and calculates the moment the pedestrian enters the model. A list of pedestrians boarding at this vehicle is made and all pedestrians are generated at the proper time. At the beginning of the simulation, SimPed has calculated the shortest routes in time from all origins to all destinations in the model. For each pedestrian, SimPed finds his shortest route, along possible activities. After a specified period of time, these shortest route matrix is recalculated and new routes are assigned to pedestrians, depending on the densities in the infrastructure.The route of a pedestrian consists of connections and activities. From one connection to another, the pedestrian has to walk through a walkway. SimPed calculates the distance between the two connections (or from a connection to an activity), and, depending on the current density in this walkway, calculates the walking time of this pedestrian, also taking the free speed of this individual pedestrian into account. During this period of time (walking time) the pedestrian holds a place in this walkway. When he arrives at the next connection, SimPed checks whether the pedestrian has to perform an activity, whether this connection is his destination and whether the pedestrian can continue its route. When a pedestrian arrives at an activity, he waits for his turn and is being served. Then he will continue his route as described above. When a pedestrian arrives at his destination, his characteristics are saved and he leaves the model. When a pedestrian can continue his route, SimPed checks whether there is space for the pedestrian in the next walkway. When there is no space, the pedestrian awaits in his current walkway until he is able to move to this next element. When there is space available, the pedestrian is removed from his current walkway and assigned to his next walkway. From here on, the process is repeated.SimArchiveSimArchive simply writes the simulation data to a database. Therefor, SimArchive makes a copy of the model database and adds the output tables. This way, the input data and the results are in one database, which is convenient for looking for mistakes in the input data.SimArchive receives the messages sent by SimPed. It looks for the right information in these messages, transforms this information into a recordset and adds the recordset to the correct table. When the simulation has ended, the resulting database is copied to the location specified by the user and SimArchive is closed.SimAnimationSimAnimation is to a large extent based on the same sources as SimInput. It shares the code for reading the model out of the database and showing graphical elements of the model. We have added a communication part, to make SimAnimation receive messages from SimPed and to transform these messages into information accessible for the user. The animation is especially used to visualize the levels of service on the infrastructure elements. For each element, a dialog can be opened, to show the characteristics of the walkway (number of pedestrians present, level of service, length, width, name, …) and to show a diagram with the number of pedestrians over time. Colors of the different levels of service are shown in  REF _Ref1108208 \h Table 1.Figure  SEQ Figure \* ARABIC 5: Technical animation3-Dimensional animationThis three dimensional animation is a separate part of the simulation tool. It is a virtual reality environment and uses the results database. First, the infrastructure is read from the database and the model is drawn. Then positions of both pedestrians and public transport vehicles are read from the database. At the given moments pedestrians are shown in the walkways and public transport vehicles arrive and depart from the platforms.Figure  SEQ Figure \* ARABIC 6: Frame of the three dimensional animation of DelftThis three dimensional animation provides a realistic view on the crowds within the station. In  REF _Ref1107927 \h Figure 3 we see the –1 level, with two light rail vehicles at each side of the platform. The viewpoint is right above the train platform and we look in the direction of the exits at the ground floor. We see groups of passengers waiting to get in the light rail vehicles and we see that queues have already been formed for the escalator leading to the train platform (transferring passengers). ConclusionsThis paper describes the dedicated pedestrian simulation tool SimPed, The tool is able to model pedestrians in transfer stations and provides inside into the comfort of the pedestrian in a transfer station during peak hours. The tool can be used in the early planning phase (when the plans are not yet elaborated and the number of stairs and escalators and the width of tunnels can be changed), but also during the design stage (when more detailed plans are drawn) and during the operational stage (bottlenecks become visible and need to be solved). The tool has already been applied successfully in several studies, among others for Rotterdam.References[1]	Fruin, J.J., Pedestrian planning and design, New York: Metropolitan Association of Urban Designers and Environmental Planners Inc, 1971Author BiographiesWINNIE DAAMEN is a researcher at the Civil Engineering Department of the Delft University of Technology. She is one of the developers of the pedestrian simulation tool SimPed. Stairs from first floor to second floorStairs from first floor to second floor Escalator from first floor to second floorStairs from ground floor to first floor