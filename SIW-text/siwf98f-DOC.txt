Algorithms for Consistent Tailoring of the Synthetic Natural Environment Peter S. DaileyTodd A. HutchinsonSteve O. OuztsTASC, Inc.55 Walkers Brook DriveReading, MA 01867-3297781-942-2000, Fax 781-942-7100psdailey@tasc.com , soouzts@tasc.comKeywords:JSIMS, Synthetic Natural Environments, User-controlled weather, Environmental TailoringABSTRACT: Editing of environmental data during a military training exercise is a common practice in the modeling and simulation community. Without proper guidance, however, there is the potential for violating basic physical constraints and correlations as well as generating unanticipated results that are counterproductive to the overall training experience. Current methods for affecting an environmental edit during the exercise are crude and the user is responsible for the scientific validity of the result.  The Joint Simulation System (JSIMS) Environmental Tailoring Services (JETS) project is addressing issues associated with both a priori and run-time tailoring of the Synthetic Natural Environment (SNE) in distributed simulations. In this paper, we first introduce the concepts behind consistent editing of an SNE.  Next, we discuss an algorithmic approach to tailoring which is relatively simple to implement and computationally efficient to utilize. Edits are performed in two stages, physical blending followed by temporal merging.  It is noted that such an approach has its drawbacks including the possibility of generating unrealistic physical fields.  Strategies for dealing with these deficiencies are discussed.1. IntroductionOne important objective of the Joint Simulation System (JSIMS) is to integrate physical environmental effects (atmosphere-ocean-space-terrain) across heterogeneous simulations to provide new levels of realism, consistency, and interoperability. In the construction of pre-distributed environmental scenarios, flexibility is critical to satisfy broad training objectives of various interests within the Modeling and Simulation arena. Specifically, on-demand tailoring of environmental data is required to make detailed adjustments to the scenario and to steer the training experience at run-time to meet specific goals. The objective of the JSIMS Environmental Tailoring Services (JETS) project is to develop techniques and guidance for this on-demand tailoring. JETS is sponsored by the Defense Advanced Research Projects Agency (DARPA) Advanced Simulation Technology Thrust (ASTT) program. There is a significant difference between use and control of the synthetic natural environment (SNE) that has been acceptable in the past as compared to SNE control that is envisioned for JSIMS. In the past, scenario changes were primarily visual and had little impact on simulations.  Presently, SNE control includes the ability to affect run-time changes to a scenario.  Simulations and their operators need data and products that are consistent and derived from a common SNE if they are to engage in “fair play” and train in a realistic manner.  It is the goal of JETS to develop algorithms that will take such run-time changes to the SNE and consistently reflect those changes in other SNE variables and times.2.  Algorithm DevelopmentNew SNE technology provided by DARPA’s Synthetic Theater of War (STOW) program and the Total Atmosphere Ocean System (TAOS) allows for high-fidelity, dynamic, physically consistent environmental data to be delivered to simulations for the first time [1]. The required ability to tailor a priori or edit in real-time the SNE presents a set of technical challenges. Today there exist various techniques to “dial” the environment, but they are manual procedures requiring the user to deal with consistency and fidelity issues introduced by the edit.  The user is ultimately responsible for assuring that edits will not lead to physically unrealistic scenarios and inappropriate training. 2.1  Research challengesThe key research challenges facing the JETS project are to:Maintain appropriate physical realism of tailored data across scenario(s) at multiple resolutionsRetain realistic correlations between physically linked environmental parametersAchieve run-time efficiency and transparencyMinimize SNE data and model construction costs while maximizing training benefits and flexibilityThese challenges and our technical approach for studying them is detailed in a previous paper [2].  In developing tailoring algorithms for JETS, we will adopt an incremental approach starting with simple efficient procedures and move to more sophisticated ones. Though tailoring algorithms developed by JETS can be applied pre-exercise or during run-time, it is the run-time application that constrains how computationally complex the approach may be.  Namely, solution of the full set of nonlinear differential equations for the atmosphere (or ocean) is not feasible during a distributed exercise.  For a real-time editing algorithm to be effective, it should:Assure that edits made to one variable are appropriately reflected in other correlated variables in a realistic manner and that the edit is smoothed with the surrounding regionAvoid abrupt temporal changes to the SNE resulting from the introduction of an edit and modification of other variables at the same time2.2  DefinitionsIn order to establish a common understanding of the algorithm development process, some terms need to be defined.  Figure 1 shows a schematic of three snapshots of some state variable X1 at times t-1, t, and t+1 where time t is the time at which SNE tailoring takes place.  Below the snapshots of X1 are snapshots of other correlated variables X2, X3, … Xn at the edit time t.Fig. 1  Variable and correlated edits and spatial and temporal blendsA variable edit is a user-specified change to the environmental scenario over some region, whether it be a priori (pre-exercise) or during run-time.  Typically, the edit is applied to one variable at a set of grid points within a rectangular subdomain.  Variable edits may be implemented using a tool such as the Gridded Weather Editor available in TAOS.  JETS tailoring algorithms will not manipulate the edit itself.  JETS algorithms will however modify the following:other (unedited) variables within the region defined by the edit (edit region) at the same time – these are called correlated editsall variables within the edit region at prior and subsequent times – these are called temporal blends A Simple Tailoring AlgorithmBased on this procedure, we are currently developing a set of simple tailoring algorithms and are evaluating their performance from both a fidelity and efficiency perspective.  Here, we introduce the approach and performance of one such algorithm, called Pressure-derived Field Manipulation (PFM).Test database for algorithm evaluationTo evaluate PFM and other algorithms, we have built a test SNE using the PSU/NCAR MM5 (Pennsylvania State University/National Center for Atmospheric Research Mesoscale Modeling System Version 5) numerical model.  An MM5 scenario is generated for a 24 hour period with state data saved every hour.  Some model grid details are shown in Table 1.  Further details pertaining to the MM5 model can be found in [3].The model is initialized using 1( x 1( NOGAPS (Navy Operational Global Atmospheric Prediction System) analysis fields from May, 1998 and run over a portion of the Middle East.  Figure 2 shows the geographical coverage of the model domain.The PFM algorithm is tested using an edit to the temperature field at t = 12 hours placed at 40.0 N latitude and 50.5 E longitude.  We define the edit at that location with a magnitude of 5 degrees Celsius and a radius of influence r of 200 km.  A weighting function specifies how the edit decays outward from the edit location ramping to zero at r.Figure 3 shows the base state and edited temperature fields at the lowest model level at time t = 12 hours.  Note that near the center of the figure, the temperature contours reflect the placement of the variable edit.The goal is to first correlate the edited temperature field with an edit to other base state variables, then temporally blend all of the edited fields with the rest of the SNE.  This involves the use of a correlation algorithm (in this case PFM) as well as temporal blending.Pressure field manipulation (PFM) algorithmThe first step is to use the edited temperature field to edit correlated fields at the same history time.  Our approach is modeled after a method used by the U.K. Meteorological Office to manipulate operational forecasts fields [4].  The technique works as follows.  A change to the mean sea level pressure field results in a change to the pressure (or geopotential height) and temperature fields above the edited pressure surface.  These modifications are made using two equations, the Ideal Gas Law and the Hydrostatic Equation.  From the modified temperature and pressure fields, we can calculate a new wind field using the Geostrophic Approximation.  Special adjustments to the near-surface wind field must be made to account for the effects of terrain and surface friction.The method was originally developed to take changes to the underlying pressure field and adjust correlated fields such as temperature, winds, and cloud ceiling.  Therefore, it is necessary for the technique to be extended for added flexibility.  The procedure has been modified as follows.  Depending on the variable being edited, a direct or indirect change to the pressure field is deduced.  A change to the pressure field may require an iterative calculation that converges on an appropriate pressure field modification.  The new pressure field is then used to modify the other fields.Figure 4 shows the original and edited surface wind fields.  Note the original wind field reflects westerly flow in the region of the edit.  The edited wind field is calculated as follows.  The geostrophic wind as it would exist at the surface (prior to the edit) is determined.  This is subtracted from the original background winds to determine the “ageostrophic” component of the surface wind.  Once edits to the surface pressure field are made, a geostrophic wind is calculated from the pressure field and then adjusted using the original ageostrophic wind.  We believe this approach is a reasonable one for purposes of M&S tailoring.Note in Figure 4, as the result of the temperature edit, there is a counterclockwise circulation in the wind field centered at the edit location.  This results from the increase in temperature and corresponding decrease in pressure.  This is a dynamically correct result based on meteorological principals of wind and pressure balance.Temporal blendingAfter application of the correlation process, the next step in consistent tailoring involves temporal blending of the edit with the surrounding SNE.  The goal is to eliminate unnatural sharp gradients which occur between the time of the edit and adjoining times.To perform the temporal blending, we have implemented a modified form of the Barnes’ algorithm.  The Barnes’ approach [5] is typically used to assimilate observations such as radar and satellite data into a mesoscale or synoptic scale analysis and requires no background field for initialization. The iteration is defined as follows:where ri is the location of the ith analysis point, and rk, 1 < k < Ki are the observation station locations within  its region of influence.  The term fA is the jth iteration of the analyzed value of f; and fo(rk) is the observation at location rk.  Wj(rik) is the specified weight function as a function of the absolute distance between observation and analysis gridpoint during the jth iteration and fA(rk) is obtained by forward interpolation of the analyzed value fA(ri) to the observation location.The specified weight function is typically given byand is a function of the iteration number j.  Lj is chosen as follows.  Define  = L2(j+1)/L2(j) for all j, where 0 ( ( 1.  Then, L2 (j+1)=j+1 L(0)2.The algorithm is typically used to blend data in space, but we have adopted the approach to blend the SNE data in time.  When applied to the test data, the Barnes algorithm improves the temporal blend of variable edits with the adjoining times significantly. Unrealistic gradients resulting from variable and correlated edits are smoothed. The choice of how many prior and subsequent times over which to apply temporal blending is really quite similar in many respects to defining “region of influence” in correlated editing.  The span of blend times can be hard coded into the algorithm, left up to the user, or based on a thresholding of temporal gradients resulting from the correlated edits.  We are working on different weighting functions to apply in both the correlated edit algorithm (PFM) and the temporal blending algorithm.It should be noted that temporal blending is often not critical to the integrity of the SNE database since typically the time spacing between data publications is an hour or more apart.  That is, the variability of the atmosphere on the time resolution of the SNE data is already quite high.  Thus, the additional variability introduced by edits to the SNE may be transparent to the exercise players.  We do however believe that temporal smoothing improves the overall fidelity of the SNE.Summary and Future WorkWe have discussed a simple technique for consistent alteration of an SNE database.  It is stressed that, although we are focused on the atmosphere in this example, the procedure can certainly be extended to other dynamic systems such as the ocean and space.The technique involves the determination of a pressure perturbation resulting from a user-specified edit.  The example of a temperature edit over a 200 km region of influence is used as an example.  Based on the modification of the pressure field, correlated edits are made to relevant state variables to reflect the physical effect of the edit (e.g., winds).The final step involves the temporal blending of the SNE data at adjoining times.  A modified version of the Barnes’ algorithm is applied to eliminate sharp and unrealistic temporal changes in the edited field as well as correlated modifications to other fields.  Again, the goal is to smooth the temporal transition into and out of the edit. Future work will include the incorporation of more complex derived variables.  These modifications to the technique may involve significant tradeoffs in efficiency.  JETS’ ultimate goal is to provide a flexible toolset of techniques of varying fidelity and complexity so that the user may choose what is appropriate given his or her tailoring needs.6.  References[1]	Whitney, D. A., et al.: “TAOS: Providing and Managing Realistic Natural Environments for Virtual Worlds”, Proceedings of the Fall Simulation Interoperability Workshop, September 1997.[2]	Driscoll, M. L., P. S. Dailey, and S. O. Ouzts, “Tailoring the Synthetic Natural Environment”, Proceedings of the Spring Simulation Interoperability Workshop, March, 1998.[3]   Grell, G. A., J. Dudhia, and D. R. Stauffer, 1995: A description of the fifth generation Penn State/NCAR mesoscale model (MM5).  NCAR Technical Note TN-398+STR, 122 pp.[4]  Carroll, E. B., “The formulation and testing of schemes to allow three-dimensionally consistent manual alteration of NWP fields”, Forecasting Systems Technical Note No. 3, UK Meteorological Office, March, 1996.[5]   Daley, R., Atmospheric Data Analysis, Cambridge Univ. Press, 1991, 457 pp.AcknowledgmentsThis work is sponsored by the Defense Advanced Research Projects Administration. Author BiographiesPeter S. Dailey is an atmospheric scientist and the technical lead for atmospheric data integration on the TAOS project. Dr. Dailey received a B.A. and B.A.S. from the University of Pennsylvania, and a M.S. and Ph. D. from the University of California at Los Angeles.Todd A. Hutchinson is an atmospheric scientist with an M. S. in Meteorology from the University of Oklahoma.  Todd has worked on various Modeling and Simulation efforts.Steve O. Ouzts, a retired US Air Force Colonel, has over 25 years experience in meteorology, space operations, modeling and simulation, and remote sensing. He has a B.S. from Auburn University, a M.S. in Atmospheric Dynamics from the Naval Postgraduate School, and an M.B.A. from the University of Nebraska. The Ideal Gas Law relates the pressure, temperature, and density while the Hydrostatic Equation relates the vertical rate of pressure change to atmospheric density. The Geostrophic Approximation relates the wind field to the horizontal pressure distribution.Fig. 3  The (a) unedited and (b) edited temperature fields at the lowest model grid level (50 m).IRANFig. 2  MM5 model domainLat/Lon BoundsVertical levelsGrid spacingLowest vertical levelGrid ProjectionLambert Conformal50 m AGL50 km23 -levelsN-S: 35.8 to 44.2 N. latE-W: 45.5 to 55.5 E. lonIRAQedit region[4] EMBED Equation.3  [3][2][1] EMBED Equation.3   EMBED Equation.3   EMBED Equation.3  Fig. 4  The (a) unedited and (b) edited wind fields.  Overlaid on each plot is the corresponding temperature field.Table 1.  MM5 Grid Details. EMBED Word.Picture.8  Caspian Sea